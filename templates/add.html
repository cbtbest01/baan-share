{% extends "base.html" %}
{% block title %}‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå{% endblock %}
{% block content %}
  <h2 class="mb-4">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå</h2>

  <form method="POST" style="max-width: 500px;">
    <div class="mb-3">
      <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏á‡πÅ‡∏ä‡∏£‡πå</label>
      <select name="group" id="groupSelect" class="form-select" required>
        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏á‡πÅ‡∏ä‡∏£‡πå --</option>
        {% for g in groups %}
          <option value="{{ g.id }}">{{ g.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏ß‡∏á</label>
      <select name="member" id="memberSelect" class="form-select" required disabled>
        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å --</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
      <select name="type" class="form-select" required>
        <option value="‡∏™‡πà‡∏á‡∏á‡∏ß‡∏î">‡∏™‡πà‡∏á‡∏á‡∏ß‡∏î</option>
        <option value="‡∏£‡∏±‡∏ö‡πÅ‡∏ä‡∏£‡πå">‡∏£‡∏±‡∏ö‡πÅ‡∏ä‡∏£‡πå</option>
        <option value="‡∏ñ‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô">‡∏ñ‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô</option>
        <option value="‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡πà‡∏≤‡∏¢">‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡πà‡∏≤‡∏¢</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
      <input type="number" name="amount" class="form-control" required>
    </div>

    <div class="mb-3">
      <label class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
      <input type="text" name="note" class="form-control">
    </div>

    <button class="btn btn-primary">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    <a href="/" class="btn btn-secondary ms-2">‚Ü©Ô∏è ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</a>
  </form>

  <script>
    const groupSelect = document.getElementById("groupSelect");
    const memberSelect = document.getElementById("memberSelect");

    groupSelect.addEventListener("change", () => {
      const groupId = groupSelect.value;
      memberSelect.innerHTML = '<option>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</option>';
      memberSelect.disabled = true;

      if (groupId) {
        fetch(`/members/by-group/${groupId}`)
          .then(res => res.json())
          .then(data => {
            memberSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å --</option>';
            data.members.forEach(m => {
              const opt = document.createElement("option");
              opt.value = m.id;
              opt.textContent = m.name;
              memberSelect.appendChild(opt);
            });
            memberSelect.disabled = false;
          });
      } else {
        memberSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å --</option>';
        memberSelect.disabled = true;
      }
    });
  </script>
{% endblock %}